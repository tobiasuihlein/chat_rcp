{% extends "./layout.html" %}

{% load static %}

{% block header-middle %}

{% endblock header-middle %}


{% block main-content %}

<div style="height: 80vh; display: flex; align-items: center; justify-content: center; flex-direction: column;">

    <div id="loading-spinner" class="spinner-overlay" style="display: none;">
        <div class="row-wrapper section-row" style="display: none;">
            <div class="row-content">
                <div class="widget">
                    <img src="{% static 'generator/img/carmy-writing.png' %}" style="width: 600px; height: auto"/>
                </div>
            </div>
        </div>
        <p style="font-weight: 600; font-size: 2rem;">Ok, let me think ...</p>
        <div class="spinner"></div>
    </div>

    <div class="row-wrapper section-row">
        <div class="row-content">
            <div class="character-container" style="position: relative;">
                <div class="shadow-container">
                    <img src="{% static 'generator/img/ghibli-shadow.svg' %}"/>
                </div>
                <div class="body-container">
                    <img src="{% static 'generator/img/ghibli-empty-eyes.svg' %}"/>
                </div>
                <div class="pupils-container">
                    <img id="pupils" src="{% static 'generator/img/ghibli-pupils.svg' %}"/>
                </div>
            </div>
        </div>
    </div>

    <div class="row-wrapper">
        <div class="row-content">
            <div class="widget">
                <div class="initial-prompt-heading typewriter">
                    <p>&thinsp;What you got for me, chef?&thinsp;</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row-wrapper section-row">
        <div class="row-content">
            <div class="widget">
                <form id="initial-prompt-form" class="searchbar" method="post" action="{% url 'generator:previews' %}">
                    {% csrf_token %}
                    <input class="searchbar-input" style="border: 0;" type="text" id="ingredients-input" name="ingredients-input" placeholder="broccoli, pasta, parmesan">
                    <button type="submit" class="searchbar-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                    </button>
                </form>
            </div>
        </div>
    </div>

</div>

{% block javascript %}

<script>
    // activate loading spinner overlay on submit
    document.getElementById('initial-prompt-form').addEventListener('submit', function(e) {
        document.getElementById('loading-spinner').style.display = 'flex';
    });

    // eye movement when searchbar focused
    const pupils = document.getElementById('pupils');
    const ingredientsInput = document.getElementById('ingredients-input');
    ingredientsInput.addEventListener('focus', (event) => {
        pupils.style.transform = `translate(0, 5px)`;
    });
    ingredientsInput.addEventListener('blur', (event) => {
        pupils.style.transform = `translate(0, 0)`;
    });

    // idle eye movement animation
    let idleTimer = null;
    function startIdleAnimation() {
        pupils.style.animation = 'moveEyes 60s infinite';
    }
    function stopIdleAnimation() {
        pupils.style.animation = '';
    }
    const style = document.createElement('style');
    style.textContent = `
        @keyframes moveEyes {
            52% { transform: translate(0, 0); }
            55% { transform: translate(3px, 3px); }
            68% { transform: translate(3px, 3px); }
            70% { transform: translate(-3px, 0); }
            83% { transform: translate(-3px, 0); }
            85% { transform: translate(0, -3px); }
            100% { transform: translate(0, 0); }
        }
    `;
    document.head.appendChild(style);
    function resetIdleTimer() {
        stopIdleAnimation();
        clearTimeout(idleTimer);
        idleTimer = setTimeout(startIdleAnimation, 3000);
    }
    document.addEventListener('mousemove', resetIdleTimer);
    document.addEventListener('keypress', resetIdleTimer);
</script>

{% endblock %}

{% endblock main-content %}